{% extends "base/index.html" %}
{% load static %}

{% block styl_parent %}
<title>Clients avec Crédit | Accueil</title>
<link rel="stylesheet" href="{% static 'base/plugins/fontawesome-free/css/all.min.css' %}">
<link rel="stylesheet" href="{% static 'base/css/adminlte.min.css' %}">
{% endblock %}

{% block body %}<body class="hold-transition sidebar-mini">{% endblock %}

{% block contenu %}
<div class="content-wrapper">
  <!-- Header -->
  <section class="content-header">
    <div class="container-fluid">
      <h1>Clients avec Crédit Actif</h1>
    </div>
  </section>

  <section class="content">
    <div class="container-fluid">

      <!-- Recherche responsive -->
      <form method="get" class="mb-3">
        <div class="row g-2">
          <div class="col-sm-8 col-md-6 col-lg-4">
            <input type="text" name="q" value="{{ query }}" class="form-control w-100" placeholder="Rechercher par client...">
          </div>
          <div class="col-auto">
            <button type="submit" class="btn btn-primary w-100">Rechercher</button>
          </div>
        </div>
      </form>

      <!-- Tableau des clients -->
      <div class="card">
        <div class="card-body table-responsive">
          <table class="table table-bordered table-striped table-hover">
            <thead class="bg-primary text-white">
              <tr>
                <th>N°</th>
                <th>Client</th>
                <th>Photo</th>
                <th>Montant Journalier</th>
                <th>Jours Versés</th>
                <th>Total Versé</th>
                <th>Crédit Actif</th>
              </tr>
            </thead>
            <tbody>
              {% for item in tickets_page %}
              <tr>
                <td>{{ item.ticket.id|stringformat:"03d" }}</td>
                <td>{{ item.ticket.client }}</td>
                <td>
                  {% if item.ticket.photo %}
                    <img src="{{ item.ticket.photo.url }}" width="50" class="img-fluid rounded">
                  {% else %}
                    Pas de photo
                  {% endif %}
                </td>
                <td>{{ item.ticket.montant_journalier|floatformat:0 }} GNF</td>
                <td>{{ item.ticket.jours_verse }}/{{ item.ticket.nombre_jours_total }}</td>
                <td>{{ item.ticket.total_verse|floatformat:0 }} GNF</td>
                <td>{{ item.credit_actif|floatformat:0 }} GNF</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="7" class="text-center">Aucun client avec crédit</td>
              </tr>
              {% endfor %}

              <!-- Total général -->
              <tr class="bg-info font-weight-bold">
                <td colspan="6" class="text-right">TOTAL CRÉDIT :</td>
                <td>{{ total_credit_general|floatformat:0 }} GNF</td>
              </tr>
            </tbody>
          </table>

          <!-- Pagination responsive -->
          <div class="d-flex justify-content-center flex-wrap mt-3 gap-1">
            <ul class="pagination">
              {% if tickets_page.has_previous %}
                <li class="page-item">
                  <a class="page-link" href="?q={{ query }}&page={{ tickets_page.previous_page_number }}">Précédent</a>
                </li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">Précédent</span></li>
              {% endif %}

              {% for num in tickets_page.paginator.page_range %}
                {% if tickets_page.number == num %}
                  <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% else %}
                  <li class="page-item"><a class="page-link" href="?q={{ query }}&page={{ num }}">{{ num }}</a></li>
                {% endif %}
              {% endfor %}

              {% if tickets_page.has_next %}
                <li class="page-item">
                  <a class="page-link" href="?q={{ query }}&page={{ tickets_page.next_page_number }}">Suivant</a>
                </li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">Suivant</span></li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>
{% endblock %}

{% block scripte %}
<script src="{% static 'base/plugins/jquery/jquery.min.js' %}"></script>
<script src="{% static 'base/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'base/js/adminlte.min.js' %}"></script>
{% endblock %}
